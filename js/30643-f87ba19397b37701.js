"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30643],{30643:function(e,n,t){t.r(n),t.d(n,{default:function(){return eT}});var o=t(3827),i=t(64090),r=t(71548),s=t(83286);function a(e){let n=e.toToken.chainId===e.onRampToken.token.chainId,t=(0,s.Kn)(e.toToken.tokenAddress)===(0,s.Kn)(e.onRampToken.token.tokenAddress);return!(n&&t)}var l=t(63621),d=t(45890),c=t(72568),u=t(51102),x=t(36187),h=t(73667),m=t(61863),p=t(23565),y=t(43051);async function f(e){try{let n=new URLSearchParams({toAddress:e.toAddress,fromCurrencySymbol:e.fromCurrencySymbol,toChainId:e.toChainId.toString(),toTokenAddress:e.toTokenAddress.toLowerCase()});e.fromAmount&&n.append("fromAmount",e.fromAmount),e.toAmount&&n.append("toAmount",e.toAmount),e.maxSlippageBPS&&n.append("maxSlippageBPS",e.maxSlippageBPS.toString()),e.isTestMode&&n.append("isTestMode",e.isTestMode.toString());let t=n.toString(),o="".concat((0,y.EW)(),"?").concat(t),i=await (0,p.NX)(e.client)(o);if(!i.ok){let e=await i.json();if(e&&"error"in e)throw e;throw Error("HTTP error! status: ".concat(i.status))}return(await i.json()).result}catch(e){throw console.error("Fetch error:",e),e}}var g=t(14297),j=t(27121),v=t(48762),C=t(94071),T=t(94234),b=t(82161),k=t(972),w=t(53326),S=t(96088),B=t(39724),L=t(31137),F=t(3702),E=t(32788),A=t(93336),W=t(72433),z=t(93610),M=t(62177),R=t(68982);function I(e){let{estimatedSeconds:n,quoteIsLoading:t}=e;return(0,o.jsxs)(L.Container,{bg:"tertiaryBg",flex:"row",borderColor:"borderColor",style:{borderRadius:c.q0.md,borderTopLeftRadius:0,borderTopRightRadius:0,justifyContent:"space-between",alignItems:"center",borderWidth:"1px",borderStyle:"solid"},children:[(0,o.jsxs)(L.Container,{flex:"row",center:"y",gap:"xxs",color:"accentText",p:"sm",children:[(0,o.jsx)(M.T39,{width:c.EA.sm,height:c.EA.sm}),t?(0,o.jsx)(b.Skeleton,{height:c.JB.xs,width:"50px",color:"borderColor"}):(0,o.jsx)(E.Text,{size:"xs",color:"secondaryText",children:void 0!==n?"~".concat((0,R.Z)(n)):"--"})]}),(0,o.jsxs)(F.Button,{variant:"ghost",onClick:e.onViewFees,gap:"xs",children:[(0,o.jsx)(L.Container,{color:"accentText",flex:"row",center:"both",children:(0,o.jsx)(D,{size:c.EA.sm})}),(0,o.jsx)(E.Text,{size:"xs",color:"secondaryText",children:"View Fees"})]})]})}let D=e=>(0,o.jsxs)("svg",{width:e.size,height:e.size,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[(0,o.jsx)("path",{d:"M9.5 1.5H2.5C1.94772 1.5 1.5 1.94772 1.5 2.5V9.5C1.5 10.0523 1.94772 10.5 2.5 10.5H9.5C10.0523 10.5 10.5 10.0523 10.5 9.5V2.5C10.5 1.94772 10.0523 1.5 9.5 1.5Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),(0,o.jsx)("path",{d:"M4.5 7.5L7.5 4.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})]});var q=t(92432);function N(e){return(0,o.jsxs)(L.Container,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderRadius:c.q0.md,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderWidth:"1px",borderStyle:"solid",borderBottom:"none",flexWrap:"nowrap",justifyContent:"space-between",alignItems:"center"},children:[(0,o.jsxs)(P,{variant:"ghost",onClick:e.onSelectCurrency,style:{minHeight:"64px",justifyContent:"flex-start",minWidth:"50%"},gap:"sm",children:[(0,o.jsx)(e.currency.icon,{size:c.EA.md}),(0,o.jsxs)(L.Container,{flex:"row",center:"y",gap:"xxs",color:"secondaryText",children:[(0,o.jsx)(E.Text,{color:"primaryText",children:e.currency.shorthand}),(0,o.jsx)(M.v4q,{width:c.EA.sm,height:c.EA.sm})]})]}),(0,o.jsx)("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:c.W0.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:c.W0.sm},children:e.isLoading?(0,o.jsx)(b.Skeleton,{width:"100px",height:c.JB.lg}):(0,o.jsx)(E.Text,{size:"lg",color:e.value?"primaryText":"secondaryText",children:e.value?"".concat((0,l.u)(Number(e.value),4)):"--"})})]})}let P=(0,q.Z)(F.Button)(()=>({"&[disabled]:hover":{borderColor:"transparent"}}));var _=t(4966);function O(e){return(0,o.jsxs)("div",{children:[(0,o.jsx)(E.Text,{size:"sm",children:"Pay with "}),(0,o.jsx)(k.L,{y:"xs"}),(0,o.jsxs)(L.Container,{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gridGap:c.W0.sm},children:[(0,o.jsx)(V,{isChecked:"creditCard"===e.selected,variant:"outline",onClick:()=>{e.onSelect("creditCard")},children:"Credit Card"}),(0,o.jsx)(V,{isChecked:"crypto"===e.selected,variant:"outline",onClick:()=>{e.onSelect("crypto")},children:"Crypto"})]})]})}let V=(0,q.Z)(F.Button)(e=>{let n=(0,_.useCustomTheme)();return{fontSize:c.JB.sm,borderColor:e.isChecked?n.colors.accentText:n.colors.borderColor,"&:hover":{borderColor:e.isChecked?n.colors.accentText:n.colors.secondaryText},gap:c.W0.xs,paddingInline:c.W0.xxs,paddingBlock:c.W0.sm,width:"100%"}});var U=t(28101);function H(e){return(0,o.jsxs)(L.Container,{children:[(0,o.jsx)(L.Container,{p:"lg",children:(0,o.jsx)(L.ModalHeader,{title:"Select Currency",onBack:e.onBack})}),(0,o.jsx)(L.Line,{}),(0,o.jsx)(k.L,{y:"lg"}),(0,o.jsx)(L.Container,{flex:"column",gap:"xs",px:"lg",children:U.QT.map(n=>(0,o.jsxs)(K,{fullWidth:!0,variant:"secondary",onClick:()=>e.onSelect(n),gap:"sm",children:[(0,o.jsx)(n.icon,{size:c.EA.lg}),(0,o.jsxs)(L.Container,{flex:"column",gap:"xxs",children:[(0,o.jsx)(E.Text,{color:"primaryText",children:n.shorthand}),(0,o.jsx)(E.Text,{size:"sm",children:n.name})]})]},n.shorthand))}),(0,o.jsx)(k.L,{y:"lg"})]})}let K=(0,q.Z)(F.Button)(()=>{let e=(0,_.useCustomTheme)();return{background:e.colors.tertiaryBg,justifyContent:"flex-start",gap:c.W0.sm,padding:c.W0.sm,"&:hover":{background:e.colors.secondaryButtonBg,transform:"scale(1.01)"},transition:"background 200ms ease, transform 150ms ease"}});function J(e,n){let t=(window.innerHeight-750)/2,o=(window.innerWidth-500)/2;return window.open("".concat(e,"&theme=").concat(n),"thirdweb Pay","width=".concat(500,", height=").concat(750,", top=").concat(t,", left=").concat(o))}var Q=t(79048),Y=t(47082),Z=t(15497),G=t(24134),$=t(10194),X=t(35149),ee=t(37697),en=t(94322),et=t(11832);function eo(e){var n,t,r,s;let a=(0,Y.useQueryClient)(),{openedWindow:l}=e,d=(0,G.s)({intentId:e.intentId,client:e.client}),c="loading";(null===(n=d.data)||void 0===n?void 0:n.status)==="ON_RAMP_TRANSFER_FAILED"||(null===(t=d.data)||void 0===t?void 0:t.status)==="PAYMENT_FAILED"?c="failed":(null===(r=d.data)||void 0===r?void 0:r.status)==="CRYPTO_SWAP_FALLBACK"?c="partialSuccess":(null===(s=d.data)||void 0===s?void 0:s.status)==="ON_RAMP_TRANSFER_COMPLETED"&&(c="completed"),(0,i.useEffect)(()=>{var e,n;l&&d.data&&((null===(e=d.data)||void 0===e?void 0:e.status)==="CRYPTO_SWAP_REQUIRED"||(null===(n=d.data)||void 0===n?void 0:n.status)==="ON_RAMP_TRANSFER_COMPLETED")&&l.close()},[d.data,l]);let u=(0,i.useRef)(!1);return(0,i.useEffect)(()=>{var e;u.current||(null===(e=d.data)||void 0===e?void 0:e.status)!=="ON_RAMP_TRANSFER_COMPLETED"||(u.current=!0,(0,$.K)(a))},[d.data,a]),(0,i.useEffect)(()=>{var n;(null===(n=d.data)||void 0===n?void 0:n.status)==="CRYPTO_SWAP_REQUIRED"&&e.onShowSwapFlow(d.data)},[d.data,e.onShowSwapFlow]),(0,o.jsxs)(L.Container,{p:"lg",children:[(0,o.jsx)(L.ModalHeader,{title:"Buy",onBack:e.onBack}),e.hasTwoSteps&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(k.L,{y:"lg"}),(0,o.jsx)(X.E,{steps:2,currentStep:1}),(0,o.jsx)(k.L,{y:"sm"}),(0,o.jsxs)(E.Text,{size:"xs",children:["Step 1 of 2 - Buying ",e.quote.onRampToken.token.symbol," with"," ",e.quote.fromCurrencyWithFees.currencySymbol]})]}),(0,o.jsx)(ei,{uiStatus:c,onDone:e.onDone,fiatStatus:d.data,client:e.client,isBuyForTx:e.isBuyForTx,quote:e.quote,isEmbed:e.isEmbed})]})}function ei(e){let{uiStatus:n}=e,t=e.fiatStatus?(0,en.B)(e.fiatStatus):void 0,i=e.fiatStatus&&"NOT_FOUND"!==e.fiatStatus.status?e.fiatStatus:void 0,r=e.quote.onRampToken,s=(0,o.jsx)(et.s,{client:e.client,token:(null==i?void 0:i.source)?{chainId:i.source.token.chainId,address:i.source.token.tokenAddress,symbol:i.source.token.symbol||"",amount:i.source.amount}:{chainId:r.token.chainId,address:r.token.tokenAddress,symbol:r.token.symbol,amount:r.amount},fiat:{amount:e.quote.fromCurrencyWithFees.amount,currencySymbol:e.quote.fromCurrencyWithFees.currencySymbol},statusMeta:(null==i?void 0:i.source)&&t?{color:null==t?void 0:t.color,text:null==t?void 0:t.status,txHash:i.source.transactionHash}:void 0});return(0,o.jsxs)(L.Container,{children:[(0,o.jsx)(k.L,{y:"xl"}),"loading"===n&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(k.L,{y:"md"}),(0,o.jsx)(L.Container,{flex:"row",center:"x",children:(0,o.jsx)(w.Spinner,{size:"3xl",color:"accentText"})}),(0,o.jsx)(k.L,{y:"md"}),(0,o.jsx)(E.Text,{color:"primaryText",size:"lg",center:!0,children:"Buy Pending"}),(0,o.jsx)(k.L,{y:"sm"}),!(0,Z.tq)()&&(0,o.jsx)(E.Text,{center:!0,children:"Complete the purchase in popup"}),(0,o.jsx)(k.L,{y:"xxl"}),s]}),"failed"===n&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(k.L,{y:"md"}),(0,o.jsx)(L.Container,{flex:"row",center:"x",children:(0,o.jsx)(ee.E,{size:c.EA["3xl"]})}),(0,o.jsx)(k.L,{y:"lg"}),(0,o.jsx)(E.Text,{color:"primaryText",size:"lg",center:!0,children:"Transaction Failed"}),(0,o.jsx)(k.L,{y:"xxl"}),s]}),"completed"===n&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(k.L,{y:"md"}),(0,o.jsx)(L.Container,{flex:"row",center:"x",color:"success",children:(0,o.jsx)(M.NhS,{width:c.EA["3xl"],height:c.EA["3xl"]})}),(0,o.jsx)(k.L,{y:"md"}),(0,o.jsx)(E.Text,{color:"primaryText",size:"lg",center:!0,children:"Buy Complete"}),e.fiatStatus&&"NOT_FOUND"!==e.fiatStatus.status&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(k.L,{y:"xxl"}),s,(0,o.jsx)(k.L,{y:"sm"})]}),!e.isEmbed&&(0,o.jsx)(F.Button,{variant:"accent",fullWidth:!0,onClick:e.onDone,children:e.isBuyForTx?"Continue Transaction":"Done"})]})]})}var er=t(4718),es=t(66766);function ea(e){let n=a(e.quote),[t,r]=(0,i.useState)(n?{id:"step-1"}:{id:"onramp-status"}),[s,l]=(0,i.useState)(e.openedWindow);return"step-1"===t.id?(0,o.jsx)(er.a,{client:e.client,onBack:e.onBack,partialQuote:(0,er.R)(e.quote),step:1,onContinue:()=>{let n=J(e.quote.onRampLink,e.theme);(0,Q.h)({type:"fiat",intentId:e.quote.intentId}),l(n),r({id:"onramp-status"})}}):"onramp-status"===t.id?(0,o.jsx)(eo,{client:e.client,intentId:e.quote.intentId,onBack:e.onBack,onViewPendingTx:e.onViewPendingTx,hasTwoSteps:n,openedWindow:s,quote:e.quote,onDone:e.onDone,onShowSwapFlow:e=>{r({id:"postonramp-swap",data:e})},isBuyForTx:e.isBuyForTx,isEmbed:e.isEmbed}):"postonramp-swap"===t.id?(0,o.jsx)(es.S,{status:t.data,quote:(0,er.R)(e.quote),client:e.client,onBack:e.onBack,onViewPendingTx:e.onViewPendingTx,onDone:e.onDone,onSwapFlowStarted:()=>{},isBuyForTx:e.isBuyForTx,isEmbed:e.isEmbed}):null}var el=t(64812),ed=t(2624);let ec=(0,t(85738).ax)({id:137,name:"Polygon",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorers:[{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.polygonscan.com/api"}]});var eu=t(6354),ex=t(96856),eh=t(49580);function em(e){var n;let t;let i=(0,u.L)(e.chain);return(0,o.jsxs)(L.Container,{children:[(0,o.jsx)("div",{onClick:e=>{var n;null===(n=e.currentTarget.querySelector("input"))||void 0===n||n.focus()},children:(0,o.jsxs)(L.Container,{flex:"row",center:"both",gap:"xs",style:{flexWrap:"nowrap"},children:[(0,o.jsx)(ex.Input,{variant:"outline",pattern:"^[0-9]*[.,]?[0-9]*$",inputMode:"decimal",placeholder:"0",type:"text","data-placeholder":""===e.value,value:e.value||"0",disabled:e.freezeAmount,onClick:n=>{""===e.value&&n.currentTarget.setSelectionRange(n.currentTarget.value.length,n.currentTarget.value.length)},onChange:n=>{let t=n.target.value;t.startsWith(".")&&(t="0".concat(t)),Number.isNaN(Number(t))||(t.startsWith("0")&&!t.startsWith("0.")?e.onChange(t.slice(1)):e.onChange(t))},style:{border:"none",fontSize:e.value.length>10?"26px":e.value.length>6?"34px":"50px",boxShadow:"none",padding:"0",paddingBlock:"2px",fontWeight:600,textAlign:"right",width:(t=e.value.replace(".","").length,e.value.includes(".")&&(t+=.3),"calc(".concat("".concat(Math.max(1,t),"ch")," + 6px)")),maxWidth:"calc(100% - 100px)"}}),(0,o.jsx)(eh.TokenSymbol,{token:e.token,chain:e.chain,size:"lg",color:"secondaryText"})]})}),!e.hideTokenSelector&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(k.L,{y:"sm"}),(0,o.jsx)(L.Container,{flex:"row",center:"x",children:(0,o.jsxs)(ep,{variant:"secondary",fullWidth:!0,style:{fontSize:c.JB.sm},gap:"xxs",onClick:e.onSelectToken,disabled:e.freezeChainAndToken,children:[(0,o.jsxs)(L.Container,{flex:"row",center:"y",gap:"sm",children:[(0,o.jsx)(B.TokenIcon,{token:e.token,chain:e.chain,size:"md",client:e.client}),(0,o.jsxs)(L.Container,{flex:"column",style:{gap:"4px"},children:[(0,o.jsx)(eh.TokenSymbol,{token:e.token,chain:e.chain,size:"sm"}),(null===(n=i.data)||void 0===n?void 0:n.name)?(0,o.jsx)(E.Text,{size:"xs",color:"secondaryText",children:i.data.name}):(0,o.jsx)(b.Skeleton,{width:"90px",height:c.JB.xs})]})]}),(0,o.jsx)(M.v4q,{width:c.EA.sm,height:c.EA.sm,style:{marginLeft:"auto"}})]})})]})]})}let ep=(0,q.Z)(F.Button)(()=>{let e=(0,_.useCustomTheme)();return{background:e.colors.tertiaryBg,border:"1px solid ".concat(e.colors.borderColor),justifyContent:"flex-start",transition:"background 0.3s",padding:c.W0.sm}});var ey=t(79515),ef=t(5447),eg=t(45164);function ej(e){var n;let t=(0,u.L)(e.chain),i=(0,g.M)(),r=(0,x.t)({address:null==i?void 0:i.address,chain:e.chain,tokenAddress:(0,z.M)(e.token)?void 0:e.token.address,client:e.client});return(0,o.jsxs)(L.Container,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderRadius:c.q0.md,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderWidth:"1px",borderStyle:"solid",borderBottom:"none",flexWrap:"nowrap",justifyContent:"space-between",minHeight:"64px",alignItems:"center"},children:[(0,o.jsxs)(F.Button,{variant:"ghost",onClick:e.onSelectToken,gap:"sm",style:{paddingInline:c.W0.sm,paddingBlock:c.W0.sm,minWidth:"50%",justifyContent:"flex-start"},disabled:e.freezeChainAndTokenSelection,children:[(0,o.jsx)(B.TokenIcon,{token:e.token,chain:e.chain,size:"md",client:e.client}),(0,o.jsxs)(L.Container,{flex:"column",gap:"xxs",children:[(0,o.jsxs)(L.Container,{flex:"row",gap:"xs",center:"y",color:"primaryText",children:[(0,o.jsx)(eh.TokenSymbol,{token:e.token,chain:e.chain,size:"sm"}),(0,o.jsx)(M.v4q,{width:c.EA.sm,height:c.EA.sm})]}),(null===(n=t.data)||void 0===n?void 0:n.name)?(0,o.jsxs)(E.Text,{size:"xs",children:[" ",t.data.name]}):(0,o.jsx)(b.Skeleton,{width:"90px",height:c.JB.xs})]})]}),(0,o.jsxs)("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:c.W0.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:c.W0.sm},children:[e.isLoading?(0,o.jsx)(b.Skeleton,{width:"120px",height:c.JB.md,color:"borderColor"}):(0,o.jsx)(E.Text,{size:"md",color:e.value?"primaryText":"secondaryText",style:{},children:(0,l.u)(Number(e.value),4)||"--"}),(0,o.jsxs)(L.Container,{flex:"row",gap:"xxs",center:"y",color:"secondaryText",children:[(0,o.jsx)(ef.o,{size:c.JB.xs}),r.data?(0,o.jsx)(E.Text,{size:"xs",color:"secondaryText",weight:500,children:(0,eg.a)(r.data,!0)}):(0,o.jsx)(b.Skeleton,{width:"70px",height:c.JB.xs})]})]})]})}var ev=t(27214),eC=t(80383);function eT(e){let n=(0,eC.oU)(e.client);return n.data?(0,o.jsx)(eb,{...e,onViewPendingTx:e.onViewPendingTx,supportedDestinations:n.data,buyForTx:e.buyForTx}):(0,o.jsx)(v.a,{})}function eb(e){var n,t,s,a,x,h,m,p,y,f,v,b,w,S,B,E;let{client:A,supportedDestinations:M,connectLocale:R,payOptions:I,buyForTx:D}=e,q=(0,g.M)(),N=(0,j.v)();(0,u.f)(M.map(e=>e.chain)||[],50);let{method:P,setMethod:_,screen:V,setScreen:K,drawerScreen:J,setDrawerScreen:Q,drawerRef:Y,drawerOverlayRef:Z,closeDrawer:G,showMainScreen:$}=function(e){let{payOptions:n}=e,[t,o]=(0,i.useState)(!1===n.buyWithCrypto?"creditCard":!1===n.buyWithFiat?"crypto":"creditCard"),[r,s]=(0,i.useState)({type:"main"}),[a,l]=(0,i.useState)(),{drawerRef:d,drawerOverlayRef:c,onClose:u}=(0,C.useDrawer)();return{method:t,setMethod:o,screen:r,setScreen:s,drawerScreen:a,setDrawerScreen:l,drawerRef:d,drawerOverlayRef:c,closeDrawer:function(){u(()=>{l(void 0)})},showMainScreen:function(){s({type:"main"})}}}({payOptions:I}),{tokenAmount:X,setTokenAmount:ee,setHasEditedAmount:en,hasEditedAmount:et,toChain:eo,setToChain:ei,deferredTokenAmount:er,fromChain:es,setFromChain:ea,toToken:ex,setToToken:eh,fromToken:ep,setFromToken:ey,selectedCurrency:ef,setSelectedCurrency:eg}=function(e){var n,t,o,r,s,a,c,u;let x=(0,j.v)(),{payOptions:h,buyForTx:m,supportedDestinations:p}=e,y=(null===(n=h.prefillBuy)||void 0===n?void 0:n.amount)||(m?String((0,l.u)(Number((0,d.n9)(m.cost-m.balance)),4)):""),[f,g]=(0,i.useState)(!1),[v,C]=(0,i.useState)(y),T=(0,eu.c)(v,300),[b,k]=(0,i.useState)((null===(t=h.prefillBuy)||void 0===t?void 0:t.chain)||(null==m?void 0:m.tx.chain)||(null===(o=p.find(e=>e.chain.id===(null==x?void 0:x.id)))||void 0===o?void 0:o.chain)||ec),[w,S]=(0,i.useState)((null===(r=h.prefillBuy)||void 0===r?void 0:r.token)||z.L),[B,L]=(0,i.useState)(!1!==h.buyWithCrypto&&(null===(a=h.buyWithCrypto)||void 0===a?void 0:null===(s=a.prefillSource)||void 0===s?void 0:s.chain)||ec),[F,E]=(0,i.useState)(!1!==h.buyWithCrypto&&(null===(u=h.buyWithCrypto)||void 0===u?void 0:null===(c=u.prefillSource)||void 0===c?void 0:c.token)||z.L),[A,W]=(0,i.useState)(U.k8);return{tokenAmount:v,setTokenAmount:C,hasEditedAmount:f,toChain:b,setToChain:k,deferredTokenAmount:T,fromChain:B,setFromChain:L,toToken:w,setToToken:S,fromToken:F,setFromToken:E,selectedCurrency:A,setHasEditedAmount:g,setSelectedCurrency:W}}({payOptions:I,buyForTx:D,supportedDestinations:M}),{amountNeeded:ej}=function(e){let{buyForTx:n,hasEditedAmount:t,isMainScreen:o,setTokenAmount:r,account:s}=e,a=!t&&o,c=!o,[u,x]=(0,i.useState)(null==n?void 0:n.cost);return(0,i.useEffect)(()=>{if(!n||c)return;let e=!0;async function t(){if(n&&e){try{let t=await (0,el.u)(n.tx,null==s?void 0:s.address);if(!e)return;if(x(t),a&&t>n.balance){let e=String((0,l.u)(Number((0,d.n9)(t-n.balance)),4));r(e)}}catch(e){}await (0,ed.D)(3e4),t()}}return t(),()=>{e=!1}},[n,a,r,c,s]),{amountNeeded:u}}({setTokenAmount:ee,buyForTx:D,hasEditedAmount:et,isMainScreen:"main"===V.type,account:q}),ev=N&&X,eT=(0,eC.QR)({client:e.client,destinationChainId:eo.id,destinationTokenAddress:(0,z.M)(ex)?r.K8:ex.address}),eb=(0,i.useMemo)(()=>eB(M,I,e.supportedTokens),[e.supportedTokens,M,I]),eF=(0,i.useMemo)(()=>{if(eT.data)return eB(eT.data,I,e.supportedTokens)},[e.supportedTokens,eT.data,I]),{showPaymentSelection:eE}=function(e){let{payOptions:n,supportedDestinations:t,toChain:o,toToken:s,method:a,setMethod:l}=e,{fiat:d,swap:c}=function(){let e=t.find(e=>e.chain.id===o.id);if(!e)return{fiat:!0,swap:!0};let n=(0,z.M)(s)?r.K8:s.address,i=e.tokens.find(e=>e.address.toLowerCase()===n.toLowerCase());return i?{fiat:i.buyWithFiatEnabled,swap:i.buyWithCryptoEnabled}:{fiat:!0,swap:!0}}(),u=!1!==n.buyWithFiat&&d,x=!1!==n.buyWithCrypto&&c;return(0,i.useEffect)(()=>{(u||x)&&("creditCard"!==a||u||l("crypto"),"crypto"!==a||x||l("creditCard"))},[u,x,a,l]),{showPaymentSelection:u&&x}}({payOptions:I,supportedDestinations:M,toChain:eo,toToken:ex,method:P,setMethod:_});if("node"===V.type)return V.node;if("select-currency"===V.type)return(0,o.jsx)(H,{onSelect:e=>{$(),eg(e)},onBack:$});if("screen-id"===V.type&&"select-to-token"===V.name){let n=M.map(e=>e.chain);return(null===(p=I.prefillBuy)||void 0===p?void 0:null===(m=p.allowEdits)||void 0===m?void 0:m.token)===!1?(0,o.jsx)(eL,{chains:n,client:e.client,connectLocale:e.connectLocale,setChain:ei,showMainScreen:$}):(0,o.jsx)(W.k,{onBack:$,tokenList:(((null==eo?void 0:eo.id)?eb[eo.id]:void 0)||[]).filter(e=>e.address!==r.K8),onTokenSelect:e=>{eh(e),$()},chain:eo,chainSelection:(null===(f=I.prefillBuy)||void 0===f?void 0:null===(y=f.allowEdits)||void 0===y?void 0:y.chain)!==!1?{chains:n,select:e=>{ei(e)}}:void 0,connectLocale:R,client:A})}if("screen-id"===V.type&&"select-from-token"===V.name&&eT.data&&eF){let n=eT.data.map(e=>e.chain);return!1!==I.buyWithCrypto&&(null===(w=I.buyWithCrypto)||void 0===w?void 0:null===(b=w.prefillSource)||void 0===b?void 0:null===(v=b.allowEdits)||void 0===v?void 0:v.token)===!1?(0,o.jsx)(eL,{chains:n,client:e.client,connectLocale:e.connectLocale,setChain:ea,showMainScreen:$}):(0,o.jsx)(W.k,{onBack:$,tokenList:(((null==es?void 0:es.id)?eF[es.id]:void 0)||[]).filter(e=>e.address!==r.K8),onTokenSelect:e=>{ey(e),K({type:"main"})},chain:es,chainSelection:!1!==I.buyWithCrypto&&(null===(E=I.buyWithCrypto)||void 0===E?void 0:null===(B=E.prefillSource)||void 0===B?void 0:null===(S=B.allowEdits)||void 0===S?void 0:S.chain)!==!1?{chains:eT.data.map(e=>e.chain),select:e=>ea(e)}:void 0,connectLocale:R,client:A})}return(0,o.jsx)(L.Container,{animate:"fadein",children:(0,o.jsxs)("div",{onClick:e=>{J&&Y.current&&!Y.current.contains(e.target)&&(e.preventDefault(),e.stopPropagation(),G())},children:[J&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(C.DrawerOverlay,{ref:Z}),(0,o.jsx)(C.Drawer,{ref:Y,close:G,children:(0,o.jsx)(T.DynamicHeight,{children:J})})]}),(0,o.jsxs)(L.Container,{p:"lg",style:{paddingBottom:0},children:[(0,o.jsx)(L.ModalHeader,{title:e.buyForTx?"Not enough ".concat(e.buyForTx.tokenSymbol):"Buy",onBack:e.onBack}),(0,o.jsx)(k.L,{y:"lg"}),!ev&&(0,o.jsx)(k.L,{y:"xl"}),ej&&e.buyForTx?(0,o.jsx)(eS,{amountNeeded:String((0,l.u)(Number((0,d.n9)(ej)),4)),buyForTx:e.buyForTx,client:A}):null,(0,o.jsx)(em,{value:X,onChange:async e=>{en(!0),ee(e)},freezeAmount:(null===(t=I.prefillBuy)||void 0===t?void 0:null===(n=t.allowEdits)||void 0===n?void 0:n.amount)===!1,freezeChainAndToken:(null===(a=I.prefillBuy)||void 0===a?void 0:null===(s=a.allowEdits)||void 0===s?void 0:s.chain)===!1&&(null===(h=I.prefillBuy)||void 0===h?void 0:null===(x=h.allowEdits)||void 0===x?void 0:x.token)===!1,token:ex,chain:eo,onSelectToken:()=>{K({type:"screen-id",name:"select-to-token"})},client:e.client,hideTokenSelector:!!e.buyForTx})]}),eE?(0,o.jsx)(k.L,{y:"lg"}):(0,o.jsx)(k.L,{y:"md"}),ev&&(0,o.jsxs)(o.Fragment,{children:[eE&&(0,o.jsxs)(L.Container,{px:"lg",children:[(0,o.jsx)(O,{selected:P,onSelect:_}),(0,o.jsx)(k.L,{y:"md"})]}),"crypto"===P&&q&&N&&(0,o.jsx)(ek,{...e,setScreen:K,setDrawerScreen:Q,tokenAmount:er,toChain:eo,toToken:ex,fromChain:es,fromToken:ep,showFromTokenSelector:()=>{K({type:"screen-id",name:"select-from-token"})},account:q,activeChain:N}),"creditCard"===P&&q&&(0,o.jsx)(ew,{...e,setScreen:K,setDrawerScreen:Q,tokenAmount:er,toChain:eo,toToken:ex,closeDrawer:G,selectedCurrency:ef,showCurrencySelector:()=>{K({type:"select-currency"})},account:q}),(0,o.jsx)(k.L,{y:"sm"})]}),(0,o.jsxs)(L.Container,{px:"lg",flex:"column",gap:"sm",children:[!ev&&(0,o.jsx)(o.Fragment,{children:!q&&e.connectButton?(0,o.jsx)("div",{children:e.connectButton}):(0,o.jsx)(F.Button,{variant:"accent",fullWidth:!0,disabled:!0,"data-disable":!0,children:"Continue"})}),q&&(0,o.jsx)(F.Button,{variant:"outline",fullWidth:!0,style:{padding:c.W0.xs,fontSize:c.JB.sm},onClick:e.onViewPendingTx,children:"View all transactions"})]}),(0,o.jsx)(k.L,{y:"lg"})]})})}function ek(e){var n,t,i,s,a,l;let{setDrawerScreen:d,setScreen:c,account:u,client:p,toChain:y,tokenAmount:f,toToken:g,fromChain:j,fromToken:v,showFromTokenSelector:C,payOptions:T}=e,b=(0,x.t)({address:u.address,chain:j,tokenAddress:(0,z.M)(v)?void 0:v.address,client:p}),B=(l=f&&!(j.id===y.id&&v===g)?{fromAddress:u.address,fromChainId:j.id,fromTokenAddress:(0,z.M)(v)?r.K8:v.address,toChainId:y.id,toTokenAddress:(0,z.M)(g)?r.K8:g.address,toAmount:f,client:p}:void 0,(0,h.useQuery)({staleTime:3e4,refetchInterval:3e4,gcTime:3e4,queryKey:["buyWithCryptoQuote",l],queryFn:()=>{if(!l)throw Error("Swap params are required");return(0,m.D)(l)},enabled:!!l,retry:(e,n)=>!(e>3||n.message.includes("Minimum purchase"))})),A=null===(n=B.data)||void 0===n?void 0:n.swapDetails.fromAmount,W=!!A&&!!b.data&&Number(b.data.displayValue)<Number(A),M=!B.data||W,R=e.activeChain.id!==j.id,D=!1!==T.buyWithCrypto?null===(t=T.buyWithCrypto)||void 0===t?void 0:t.prefillSource:void 0;return(0,o.jsxs)(L.Container,{px:"lg",flex:"column",gap:"md",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)(ej,{value:A||"",onSelectToken:C,chain:j,token:v,isLoading:B.isLoading&&!A,client:p,freezeChainAndTokenSelection:(null==D?void 0:null===(i=D.allowEdits)||void 0===i?void 0:i.chain)===!1&&(null==D?void 0:null===(s=D.allowEdits)||void 0===s?void 0:s.token)===!1}),(0,o.jsx)(I,{quoteIsLoading:B.isLoading,estimatedSeconds:null===(a=B.data)||void 0===a?void 0:a.swapDetails.estimated.durationSeconds,onViewFees:function(){B.data&&d((0,o.jsxs)("div",{children:[(0,o.jsx)(E.Text,{size:"lg",color:"primaryText",children:"Fees"}),(0,o.jsx)(k.L,{y:"lg"}),(0,o.jsx)(ey.O,{quote:B.data,align:"left"})]}))}})]}),B.error&&(0,o.jsx)(E.Text,{color:"danger",size:"sm",center:!0,children:function(e){let n="Unable to get price quote";try{if(e instanceof Error&&e.message.includes("Minimum"))return e.message.replace("Fetch failed: Error: ","");return n}catch(e){return n}}(B.error)}),!R||B.isLoading||W||B.error?(0,o.jsx)(F.Button,{variant:M?"outline":"accent",fullWidth:!0,"data-disabled":M,disabled:M,onClick:async()=>{M||!B.data||c({type:"node",node:(0,o.jsx)(ev.$,{isBuyForTx:!!e.buyForTx,isEmbed:e.isEmbed,client:p,onBack:()=>{c({type:"main"})},buyWithCryptoQuote:B.data,account:u,onViewPendingTx:e.onViewPendingTx,isFiatFlow:!1,onDone:e.onDone,onTryAgain:()=>{c({type:"main"}),B.refetch()}})})},gap:"xs",children:W?(0,o.jsx)(E.Text,{color:"danger",children:"Not Enough Funds"}):B.isLoading?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(w.Spinner,{size:"sm",color:"accentText"}),"Getting price quote"]}):"Continue"}):(0,o.jsx)(S.v,{variant:"accent",fullWidth:!0,chain:j})]})}function ew(e){var n,t,i;let{toToken:s,tokenAmount:l,account:d,client:c,setScreen:u,setDrawerScreen:x,toChain:m,showCurrencySelector:p,selectedCurrency:y}=e,g=e.payOptions.buyWithFiat,j=(i=!1!==g&&l?{fromCurrencySymbol:y.shorthand,toChainId:m.id,toAddress:d.address,toTokenAddress:(0,z.M)(s)?r.K8:s.address,toAmount:l,client:c,isTestMode:null==g?void 0:g.testMode}:void 0,(0,h.useQuery)({queryKey:["useBuyWithFiatQuote",i],queryFn:async()=>{if(!i)throw Error("No params provided");return f(i)},enabled:!!i,retry(e,n){if(e>3)return!1;try{if("MINIMUM_PURCHASE_AMOUNT"===n.error.code)return!1}catch(e){}return!0}})),v=!j.data;return(0,o.jsxs)(L.Container,{px:"lg",flex:"column",gap:"md",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)(N,{isLoading:j.isLoading,value:null===(n=j.data)||void 0===n?void 0:n.fromCurrencyWithFees.amount,client:c,currency:y,onSelectCurrency:p}),(0,o.jsx)(I,{quoteIsLoading:j.isLoading,estimatedSeconds:null===(t=j.data)||void 0===t?void 0:t.estimatedDurationSeconds,onViewFees:function(){j.data&&x((0,o.jsxs)("div",{children:[(0,o.jsx)(E.Text,{size:"lg",color:"primaryText",children:"Fees"}),(0,o.jsx)(k.L,{y:"lg"}),(0,o.jsx)(ey.W,{quote:j.data})]}))}})]}),j.error&&(0,o.jsx)("div",{children:(function(e){try{if("MINIMUM_PURCHASE_AMOUNT"===e.error.code){let n=e.error;return["Minimum purchase amount is $".concat(n.data.minimumAmountUSDCents/100),"Requested amount is $".concat(n.data.requestedAmountUSDCents/100)]}}catch(e){}return["Unable to get price quote"]})(j.error).map(e=>(0,o.jsx)(E.Text,{color:"danger",size:"sm",center:!0,multiline:!0,children:e},e))}),(0,o.jsx)(F.Button,{variant:v?"outline":"accent","data-disabled":v,disabled:v,fullWidth:!0,onClick:function(){if(!j.data)return;let n=a(j.data),t=null;n||(t=J(j.data.onRampLink,"string"==typeof e.theme?e.theme:e.theme.type),(0,Q.h)({type:"fiat",intentId:j.data.intentId})),u({type:"node",node:(0,o.jsx)(ea,{isBuyForTx:!!e.buyForTx,quote:j.data,onBack:()=>{u({type:"main"})},client:c,testMode:!1!==g&&((null==g?void 0:g.testMode)||!1),theme:"string"==typeof e.theme?e.theme:e.theme.type,onViewPendingTx:e.onViewPendingTx,openedWindow:t,onDone:e.onDone,isEmbed:e.isEmbed})})},gap:"xs",children:j.isLoading?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(w.Spinner,{size:"sm",color:"accentText"}),"Getting price quote"]}):"Continue"})]})}function eS(e){let n=(0,u.L)(e.buyForTx.tx.chain);return(0,o.jsxs)(L.Container,{children:[(0,o.jsx)(k.L,{y:"xs"}),(0,o.jsxs)(L.Container,{flex:"row",style:{justifyContent:"space-between"},children:[(0,o.jsx)(E.Text,{size:"sm",children:"Amount Needed"}),(0,o.jsxs)(L.Container,{flex:"column",style:{alignItems:"flex-end"},children:[(0,o.jsxs)(L.Container,{flex:"row",gap:"xs",center:"y",children:[(0,o.jsxs)(E.Text,{color:"primaryText",size:"sm",children:[e.amountNeeded," ",e.buyForTx.tokenSymbol]}),(0,o.jsx)(B.TokenIcon,{chain:e.buyForTx.tx.chain,client:e.client,size:"sm",token:z.L})]}),(0,o.jsx)(k.L,{y:"xxs"}),n.data?(0,o.jsxs)(E.Text,{size:"sm",children:[" ",n.data.name]}):(0,o.jsx)(b.Skeleton,{height:c.JB.sm,width:"50px"})]})]}),(0,o.jsx)(k.L,{y:"md"}),(0,o.jsx)(L.Line,{}),(0,o.jsx)(k.L,{y:"md"}),(0,o.jsxs)(L.Container,{flex:"row",style:{justifyContent:"space-between"},children:[(0,o.jsx)(E.Text,{size:"sm",children:"Your Balance"}),(0,o.jsxs)(L.Container,{flex:"row",gap:"xs",children:[(0,o.jsxs)(E.Text,{color:"primaryText",size:"sm",children:[(0,l.u)(Number((0,d.n9)(e.buyForTx.balance)),4)," ",e.buyForTx.tokenSymbol]}),(0,o.jsx)(B.TokenIcon,{chain:e.buyForTx.tx.chain,client:e.client,size:"sm",token:z.L})]})]}),(0,o.jsx)(k.L,{y:"md"}),(0,o.jsx)(L.Line,{}),(0,o.jsx)(k.L,{y:"lg"}),(0,o.jsx)(E.Text,{center:!0,size:"sm",children:"Purchase"}),(0,o.jsx)(k.L,{y:"xxs"})]})}function eB(e,n,t){let o={},i=!1===n.buyWithFiat,r=!1===n.buyWithCrypto;for(let n of e)o[n.chain.id]=n.tokens.filter(e=>!!e.buyWithCryptoEnabled&&!!e.buyWithFiatEnabled||(!!e.buyWithCryptoEnabled||!i)&&(!!e.buyWithFiatEnabled||!r));if(t)for(let e in t){let n=Number(e),i=t[n];i&&(o[n]=i)}return o}function eL(e){return(0,o.jsx)(A.NetworkSelectorContent,{client:e.client,connectLocale:e.connectLocale,showTabs:!1,onBack:e.showMainScreen,chains:e.chains,closeModal:e.showMainScreen,networkSelector:{renderChain:n=>(0,o.jsx)(A.ChainButton,{chain:n.chain,confirming:!1,switchingFailed:!1,onClick:()=>{e.setChain(n.chain),e.showMainScreen()},client:e.client,connectLocale:e.connectLocale})}})}},94071:function(e,n,t){t.r(n),t.d(n,{Drawer:function(){return p},DrawerContainer:function(){return y},DrawerOverlay:function(){return g},drawerOpenAnimation:function(){return f},useDrawer:function(){return j}});var o=t(56093),i=t(3827),r=t(34686),s=t(62177),a=t(64090),l=t(4966),d=t(72568),c=t(96635),u=t(58852),x=t(54765),h=t(3702);function m(){let e=(0,o._)(["\n  from {\n    opacity: 0;\n    transform: translateY(100px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n"]);return m=function(){return e},e}let p=(0,a.forwardRef)(function(e,n){return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(y,{ref:n,children:[(0,i.jsx)(x.CrossContainer,{children:(0,i.jsx)(h.IconButton,{type:"button","aria-label":"Close",onClick:e.close,children:(0,i.jsx)(s.Pxu,{width:d.EA.md,height:d.EA.md,style:{color:"inherit"}})})}),e.children]})})}),y=(0,u.lx)(()=>{let e=(0,l.useCustomTheme)();return{zIndex:1e4,padding:d.W0.lg,borderTopLeftRadius:d.q0.xl,borderTopRightRadius:d.q0.xl,background:e.colors.modalBg,position:"absolute",bottom:0,left:0,right:0,animation:"".concat(f," 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1)"),borderTop:"1px solid ".concat(e.colors.borderColor)}}),f=(0,r.F4)(m()),g=(0,u.lx)(()=>({backgroundColor:(0,l.useCustomTheme)().colors.modalOverlayBg,zIndex:9999,position:"absolute",inset:0,animation:"".concat(c.BX," 400ms cubic-bezier(0.16, 1, 0.3, 1)")}));function j(){let e=(0,a.useRef)(null),n=(0,a.useRef)(null);return{drawerRef:e,drawerOverlayRef:n,onClose:t=>{if(e.current){var o;let i={easing:"cubic-bezier(0.175, 0.885, 0.32, 1.1)",fill:"forwards",duration:300},r=e.current.animate([{transform:"translateY(100%)",opacity:0}],i);null===(o=n.current)||void 0===o||o.animate([{opacity:0}],i),r.onfinish=t}else t()}}}}}]);